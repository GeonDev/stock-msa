#!/bin/zsh

# 인텔리제이 및 다양한 터미널 환경 대응
export PATH="$PATH:/usr/local/bin:/opt/homebrew/bin"

COMMIT_MSG_FILE=$1
COMMIT_SOURCE=$2 # 커밋 소스 (message, template, merge 등)

PROJECT_ROOT=$(git rev-parse --show-toplevel 2>/dev/null || pwd)
TMP_MSG_FILE="$PROJECT_ROOT/.git/GEMINI_MSG_TMP"
REPORT_FILE="$PROJECT_ROOT/GEMINI_REPORT.md"

# 1. 일반적인 커밋 상황(신규 커밋, 템플릿 사용 등)에서만 동작
if [[ -z "$COMMIT_SOURCE" || "$COMMIT_SOURCE" == "template" || "$COMMIT_SOURCE" == "message" ]]; then
    
    # 2. pre-commit 단계에서 생성된 AI 추천 메시지가 있는지 확인
    if [ -f "$TMP_MSG_FILE" ] && [ -s "$TMP_MSG_FILE" ]; then
        AI_MSG=$(cat "$TMP_MSG_FILE")
        
        # 3. AI 메시지를 커밋 메시지의 기본값으로 설정
        echo "$AI_MSG" > "$COMMIT_MSG_FILE"
        
        # 4. 사용한 임시 파일 정리
        rm "$TMP_MSG_FILE"
    fi
fi
